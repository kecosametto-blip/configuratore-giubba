<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Configuratore Giubba Trotto</title>
  <style>
    :root { --bg:#0b0f19; --card:#121a2a; --muted:#8aa0c8; --txt:#e9f0ff; --line:#1f2b44; }
    *{ box-sizing:border-box; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body{ margin:0; background:linear-gradient(180deg,#070a12, #0b0f19 30%, #070a12); color:var(--txt); }
    .wrap{ max-width:1100px; margin:0 auto; padding:18px; display:grid; grid-template-columns: 380px 1fr; gap:16px; }
    .card{ background:rgba(18,26,42,.9); border:1px solid var(--line); border-radius:16px; padding:14px; box-shadow:0 10px 30px rgba(0,0,0,.25); }
    h1{ font-size:18px; margin:0 0 10px; }
    h2{ font-size:14px; margin:14px 0 8px; color:#cfe0ff; }
    .muted{ color:var(--muted); font-size:12px; line-height:1.3; }
    .row{ display:flex; gap:10px; align-items:center; margin:8px 0; }
    label{ font-size:12px; color:#cfe0ff; width:92px; }
    select, input[type="text"]{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid #263552;
      background:#0c1425;
      color:var(--txt);
      outline:none;
    }
    input[type="text"]::placeholder{ color:#6f86ad; }
    .btns{ display:flex; gap:10px; margin-top:10px; }
    button{
      width:100%;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #2a3a5c;
      background:#13203a;
      color:var(--txt);
      cursor:pointer;
    }
    button:hover{ filter:brightness(1.08); }
    button.primary{ background:#1b3a78; border-color:#2d57a7; }
    .step{ display:flex; gap:8px; margin:6px 0 12px; }
    .pill{
      font-size:12px; padding:6px 10px; border-radius:999px;
      border:1px solid #2a3a5c; background:#0c1425; color:#cfe0ff;
    }
    .pill.on{ background:#1b3a78; border-color:#2d57a7; }

    /* ✅ Anteprima: grigio chiaro -> grigio scuro */
    .preview{
      min-height:520px;
      display:flex; align-items:center; justify-content:center;
      background: linear-gradient(135deg, #eeeeee 0%, #bdbdbd 45%, #6e6e6e 100%);
      border-radius:16px;
      border:1px solid var(--line);
      overflow:hidden;
      position:relative;
    }

    #svgHost svg{ width:min(640px, 92%); height:auto; }
    .hint{ margin-top:8px; font-size:12px; color:var(--muted); }
    .small{ font-size:11px; color:#9db3da; }

    /* ✅ Scelta modello con icone */
    .modelGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      margin-top:6px;
    }
    .modelChoice{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px;
      border-radius:14px;
      border:1px solid #2a3a5c;
      background:#0c1425;
      cursor:pointer;
      user-select:none;
    }
    .modelChoice:hover{ filter:brightness(1.06); }
    .modelChoice img{
      width:44px; height:44px; object-fit:contain;
      background:#0b1020;
      border:1px solid #243353;
      border-radius:10px;
      padding:4px;
    }
    .modelChoice .t1{ font-size:13px; color:#e9f0ff; font-weight:700; line-height:1.1; }
    .modelChoice .t2{ font-size:11px; color:#9db3da; line-height:1.1; margin-top:2px; }

    input.modelRadio{ display:none; }
    input.modelRadio:checked + .modelChoice{
      background:#1b3a78;
      border-color:#2d57a7;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Configuratore giubba da trotto</h1>
      <div class="step">
        <div class="pill on" id="pill1">1) Modello</div>
        <div class="pill" id="pill2">2) Colori</div>
        <div class="pill" id="pill3">3) Testi</div>
      </div>

      <h2>Step 1 — Scegli il modello</h2>

      <!-- ✅ Radio con icone -->
      <div class="modelGrid" role="radiogroup" aria-label="Scelta modello">
        <div>
          <input class="modelRadio" type="radio" name="model" id="m1" value="prova1puro.svg">
          <label class="modelChoice" for="m1">
            <img src="prova1icona.png" alt="Anteprima Prova 1">
            <div>
              <div class="t1">Prova 1</div>
              <div class="t2">prova1puro.svg</div>
            </div>
          </label>
        </div>

        <div>
          <input class="modelRadio" type="radio" name="model" id="m2" value="prova2puro.svg" checked>
          <label class="modelChoice" for="m2">
            <img src="prova2icona.png" alt="Anteprima Prova 2">
            <div>
              <div class="t1">Prova 2</div>
              <div class="t2">prova2puro.svg</div>
            </div>
          </label>
        </div>
      </div>

      <div class="muted" style="margin-top:8px">
        Metti nella stessa cartella: <b>prova1puro.svg</b>, <b>prova2puro.svg</b>, <b>prova1icona.png</b>, <b>prova2icona.png</b>.
      </div>

      <h2>Step 2 — Colori</h2>
      <div class="row">
        <label>Colore 1</label>
        <select id="c1"></select>
      </div>
      <div class="row">
        <label>Colore 2</label>
        <select id="c2"></select>
      </div>
      <div class="row">
        <label>Colore 3</label>
        <select id="c3"></select>
      </div>
      <div class="small">Suggerimento: “Colore 3” spesso coincide con profili/contorni (nero di base).</div>

      <h2>Step 3 — Testi (modifica quelli già presenti nell’SVG)</h2>
      <div class="row">
        <label>Nome</label>
        <input id="pocketName" type="text" placeholder="Nome sul taschino" maxlength="18" />
      </div>
      <div class="row">
        <label>Iniziali</label>
        <input id="sleeveInit" type="text" placeholder="ES: GC" maxlength="3" />
      </div>

      <div class="btns">
        <button id="resetBtn">Reset</button>
        <button class="primary" id="applyBtn">Applica</button>
      </div>

      <div class="hint">
        Qui non “disegniamo” testo nuovo: aggiorniamo i <b>&lt;text&gt;</b> già posizionati nei file SVG usando i loro ID.
      </div>
    </div>

    <div class="card">
      <h1>Anteprima</h1>
      <div class="preview">
        <div id="svgHost" aria-label="Anteprima giubba"></div>
      </div>
      <div class="hint">Se vedi 404, controlla che i file siano nella stessa cartella della pagina (o correggi i percorsi).</div>
    </div>
  </div>

<script>
  // ====== CONFIG COLOURS (standard) ======
  const COLOR_OPTIONS = [
    ["Nero", "#000000"],
    ["Bianco", "#FFFFFF"],
    ["Rosso", "#FF0000"],
    ["Bordeaux", "#7A0019"],
    ["Blu Navy", "#0B1B3A"],
    ["Blu Royal", "#0047FF"],
    ["Azzurro", "#35A7FF"],
    ["Verde", "#00A651"],
    ["Verde Scuro", "#0B5D1E"],
    ["Giallo", "#FFD200"],
    ["Oro", "#C9A227"],
    ["Arancio", "#FF6A00"],
    ["Viola", "#6D28D9"],
    ["Fucsia", "#FF2DAA"],
    ["Grigio", "#808080"]
  ];

  // Placeholder colors presenti negli SVG caricati
  const PLACEHOLDER = { c1:"#ff0000", c2:"#ffffff", c3:"#000000" };

  // ====== DOM ======
  const modelRadios = [...document.querySelectorAll("input.modelRadio[name='model']")];
  const c1Sel = document.getElementById("c1");
  const c2Sel = document.getElementById("c2");
  const c3Sel = document.getElementById("c3");
  const pocketName = document.getElementById("pocketName");
  const sleeveInit = document.getElementById("sleeveInit");
  const svgHost = document.getElementById("svgHost");
  const applyBtn = document.getElementById("applyBtn");
  const resetBtn = document.getElementById("resetBtn");

  const pill1 = document.getElementById("pill1");
  const pill2 = document.getElementById("pill2");
  const pill3 = document.getElementById("pill3");

  function currentModelUrl(){
    const checked = modelRadios.find(r => r.checked);
    return checked ? checked.value : "prova2puro.svg";
  }

  function fillSelect(sel, defaultHex){
    sel.innerHTML = "";
    for(const [name, hex] of COLOR_OPTIONS){
      const opt = document.createElement("option");
      opt.value = hex;
      opt.textContent = `${name} (${hex})`;
      sel.appendChild(opt);
    }
    const found = [...sel.options].find(o => o.value.toLowerCase() === defaultHex.toLowerCase());
    sel.value = found ? found.value : COLOR_OPTIONS[0][1];
  }

  fillSelect(c1Sel, "#FF0000");
  fillSelect(c2Sel, "#FFFFFF");
  fillSelect(c3Sel, "#000000");

  // ====== SVG LOAD / APPLY ======
  let currentSvgDoc = null;

  async function loadModel(url){
    pill1.classList.add("on"); pill2.classList.remove("on"); pill3.classList.remove("on");

    svgHost.innerHTML = "<div class='muted'>Caricamento modello…</div>";
    const res = await fetch(url, { cache: "no-store" });
    if(!res.ok){
      svgHost.innerHTML = `<div class="muted">Errore: non trovo <b>${url}</b>. Controlla che il file sia nella stessa cartella della pagina.</div>`;
      currentSvgDoc = null;
      return;
    }
    const txt = await res.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(txt, "image/svg+xml");
    const svg = doc.documentElement;

    svg.querySelectorAll("script").forEach(s => s.remove());

    svgHost.innerHTML = "";
    svgHost.appendChild(svg);
    currentSvgDoc = svg;

    applyAll();
  }

  function setFill(el, hex){
    el.setAttribute("fill", hex);
    const style = el.getAttribute("style");
    if(style && style.includes("fill:")){
      el.setAttribute("style", style.replace(/fill\s*:\s*[^;]+/i, `fill:${hex}`));
    }
  }

  function getElementFill(el){
    const f = el.getAttribute("fill");
    if(f && f !== "none") return f;
    const style = el.getAttribute("style") || "";
    const m = style.match(/fill\s*:\s*([^;]+)/i);
    if(m) return m[1].trim();
    return null;
  }

  function recolorSvg(svg, colors){
    pill1.classList.remove("on"); pill2.classList.add("on"); pill3.classList.remove("on");

    const all = svg.querySelectorAll("*");
    all.forEach(el => {
      const id = (el.getAttribute("id") || "").toLowerCase();

      if(id.startsWith("colore_1")) return setFill(el, colors.c1);
      if(id.startsWith("colore_2")) return setFill(el, colors.c2);
      if(id.startsWith("colore_3")) return setFill(el, colors.c3);

      const f = getElementFill(el);
      if(!f) return;

      const fl = f.toLowerCase();
      if(fl === PLACEHOLDER.c1) setFill(el, colors.c1);
      else if(fl === PLACEHOLDER.c2) setFill(el, colors.c2);
      else if(fl === PLACEHOLDER.c3) setFill(el, colors.c3);
    });
  }

  // ✅ Aggiorna i <text> già esistenti nell’SVG (quelli che hai posizionato tu)
  function applyTexts(svg, name, initials){
    pill1.classList.remove("on"); pill2.classList.remove("on"); pill3.classList.add("on");

    const url = currentModelUrl();

    // mappa ID testo per modello (come risultano nei tuoi SVG)
    const map = {
      "prova1puro.svg": { nameId: "nome_colore_2", initId: "iniziali_colore_2" },
      "prova2puro.svg": { nameId: "nome_colore_1", initId: "iniziali_colore_2" }
    };

    const ids = map[url] || map["prova2puro.svg"];

    const nameEl = svg.querySelector(`#${CSS.escape(ids.nameId)}`);
    const initEl = svg.querySelector(`#${CSS.escape(ids.initId)}`);

    if(nameEl){
      nameEl.textContent = (name || "").trim();
    }
    if(initEl){
      initEl.textContent = (initials || "").trim().toUpperCase();
    }
  }

  function applyAll(){
    if(!currentSvgDoc) return;

    const colors = { c1: c1Sel.value, c2: c2Sel.value, c3: c3Sel.value };
    recolorSvg(currentSvgDoc, colors);

    const name = pocketName.value;
    const init = sleeveInit.value;
    applyTexts(currentSvgDoc, name, init);
  }

  // ====== Events ======
  modelRadios.forEach(r => r.addEventListener("change", () => loadModel(currentModelUrl())));
  applyBtn.addEventListener("click", applyAll);

  [c1Sel, c2Sel, c3Sel, pocketName, sleeveInit].forEach(el => {
    el.addEventListener("input", applyAll);
    el.addEventListener("change", applyAll);
  });

  resetBtn.addEventListener("click", () => {
    document.getElementById("m2").checked = true;
    c1Sel.value = "#FF0000";
    c2Sel.value = "#FFFFFF";
    c3Sel.value = "#000000";
    pocketName.value = "";
    sleeveInit.value = "";
    loadModel(currentModelUrl());
  });

  // ====== Start ======
  loadModel(currentModelUrl());
</script>
</body>
</html>
